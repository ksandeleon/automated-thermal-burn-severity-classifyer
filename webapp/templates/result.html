<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classification Result - Skin Burn Classifier</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet"
        href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet"
        href="{{ url_for('static', filename='css/result-style.css') }}">
    <style>
        .equation-box {
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            line-height: 1.8;
            border-left: 4px solid #0d6efd;
        }

        .equation-box code {
            color: #0f5132;
            background: transparent;
            padding: 0;
        }

        .math-flow .card {
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .math-flow .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
    </style>
</head>

<body>
    <!-- Background with animated gradient -->
    <div class="main-bg">
        <div class="gradient-overlay"></div>
        <div class="floating-shapes">
            <div class="shape shape-1"></div>
            <div class="shape shape-2"></div>
            <div class="shape shape-3"></div>
            <div class="shape shape-4"></div>
        </div>
    </div>
    <div class="container-fluid min-vh-100 d-flex align-items-center justify-content-center py-3 py-md-5 px-2 px-sm-3">
        <div class="row w-100 justify-content-center">
            <div class="col-xl-8 col-lg-10 col-md-11 col-12">
                <div class="main-card shadow-lg">
                    <!-- Header Section -->
                    <div class="card-header-custom text-center">
                        <div class="header-icon mb-3">
                            <i class="fas fa-fire-flame-curved"></i>
                        </div>
                        <h1 class="display-4 fw-bold mb-2">Classification Results</h1>
                        <p class="lead mb-0">AI-Powered Skin Burn Severity Analysis</p>
                        <div class="header-underline"></div>
                    </div>
                    <!-- Body Section -->
                    <div class="card-body-custom">
                        <!-- Debug & Computational Analysis Toggle -->
                        <div class="mb-4 d-flex justify-content-end align-items-center gap-3 flex-wrap"
                            style="min-width:220px;">
                            <span class="fw-semibold text-dark d-flex align-items-center gap-2"
                                style="font-size:1.05rem;">
                                <i class="fas fa-eye text-secondary"></i> Attention Map
                            </span>
                            <div class="form-switch d-flex align-items-center">
                                <input type="checkbox" id="debugToggle" class="form-check-input debug-switch"
                                    style="width:2.5em;height:1.5em;cursor:pointer;vertical-align:middle;">
                            </div>

                            {% if computational_data %}
                            <span class="fw-semibold text-dark d-flex align-items-center gap-2"
                                style="font-size:1.05rem;">
                                <i class="fas fa-calculator text-primary"></i> Computational Flow
                            </span>
                            <div class="form-switch d-flex align-items-center">
                                <input type="checkbox" id="computationalToggle" class="form-check-input debug-switch"
                                    style="width:2.5em;height:1.5em;cursor:pointer;vertical-align:middle;">
                            </div>
                            {% endif %}
                        </div>
                        <div class="row g-4">
                            <!-- Image Display -->
                            <div class="col-md-6">
                                <h5 class="section-title mb-3">
                                    <i class="fas fa-image me-2"></i>Analyzed Image
                                </h5>
                                <div class="preview-container mx-auto" style="max-width:400px;">
                                    <img src="{{ image_path }}" alt="Uploaded burn image" class="preview-image">
                                </div>
                            </div>
                            <!-- Results -->
                            <div class="col-md-6">
                                <h5 class="section-title mb-3">
                                    <i class="fas fa-brain me-2"></i>Classification Result
                                </h5>
                                <div class="result-card card mb-4 p-3 border-0 shadow-sm">
                                    <div class="text-center mb-3">
                                        <!-- Large Animated Icon -->
                                        <div class="mb-3">
                                            <i class="{% if result.class_id == 4 %}fas fa-thumbs-up text-success
                                            {% elif result.class_id == 0 %}fas fa-leaf text-success
                                            {% elif result.class_id == 1 %}fas fa-fire text-warning
                                            {% elif result.class_id == 2 %}fas fa-exclamation-triangle text-danger
                                            {% else %}fas fa-skull-crossbones text-danger
                                            {% endif %} result-icon-animated"></i>
                                        </div>
                                        <h2
                                            class="fw-bold mb-2 result-title {% if result.class_id == 4 %}text-success{% elif result.class_id == 0 %}text-success{% elif result.class_id == 1 %}text-warning{% else %}text-danger{% endif %}">
                                            {{ result.predicted_class }}
                                        </h2>
                                        <div class="confidence-box mx-auto mb-2 p-2 rounded-3 bg-light border">
                                            <span class="fw-semibold text-dark">Confidence:</span>
                                            <span
                                                class="fs-5 fw-bold ms-2">{{ "%.2f"|format(result.confidence * 100) }}%</span>
                                        </div>
                                    </div>
                                    <h6 class="mb-2">Detailed Probabilities:</h6>
                                    <div class="mb-3">
                                        {% for class_name, probability in result.all_probabilities.items() %}
                                        <div class="mb-3">
                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                <span class="fw-semibold">
                                                    {% if loop.index == 1 %}<i
                                                        class="fas fa-leaf text-success me-1"></i>
                                                    {% elif loop.index == 2 %}<i
                                                        class="fas fa-fire text-warning me-1"></i>
                                                    {% elif loop.index == 3 %}<i
                                                        class="fas fa-exclamation-triangle text-danger me-1"></i>
                                                    {% elif loop.index == 4 %}<i
                                                        class="fas fa-skull-crossbones text-danger me-1"></i>
                                                    {% else %}<i class="fas fa-thumbs-up text-success me-1"></i>
                                                    {% endif %}
                                                    {{ class_name }}:
                                                </span>
                                                <span
                                                    class="fw-bold">{{ "%.2f"|format(probability * 100) }}%</span>
                                            </div>
                                            <div class="progress custom-progress"
                                                style="height: 12px; background: #f3f3f3; border-radius: 8px;">
                                                <div class="progress-bar
                                                    {% if loop.index == 1 %}bg-success
                                                    {% elif loop.index == 2 %}bg-warning
                                                    {% elif loop.index == 5 %}bg-success
                                                    {% else %}bg-danger
                                                    {% endif %}" role="progressbar"
                                                    style="width: {{ probability * 100 }}%; border-radius: 8px; transition: width 0.6s cubic-bezier(0.4,0,0.2,1);">
                                                </div>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Grad-CAM Overlay (hidden by default) -->
                        <div class="row mb-4" id="gradcamSection" style="display:none;">
                            <div class="col-md-6">
                                <h5 class="section-title mb-3">
                                    <i class="fas fa-layer-group me-2"></i>Grad-CAM Overlay
                                </h5>
                                <div class="preview-container mx-auto" style="max-width:400px;">
                                    <img src="{{ overlay_path }}" alt="Grad-CAM overlay" class="preview-image">
                                </div>
                            </div>
                        </div>

                        <!-- Computational Flow Analysis (hidden by default) -->
                        {% if computational_data %}
                        <div class="row mb-4" id="computationalSection" style="display:none;">
                            <div class="col-12">
                                <div class="card shadow-sm border-0">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="mb-0">
                                            <i class="fas fa-brain me-2"></i>
                                            Hybrid CNN-Transformer Computational Flow
                                        </h5>
                                    </div>
                                    <div class="card-body" style="max-height: 600px; overflow-y: auto;">

                                        <!-- Tabs for different analysis types -->
                                        <ul class="nav nav-tabs mb-3" id="analysisTab" role="tablist">
                                            <li class="nav-item" role="presentation">
                                                <button class="nav-link active" id="summary-tab" data-bs-toggle="tab"
                                                    data-bs-target="#summary" type="button">
                                                    <i class="fas fa-chart-line me-1"></i> Summary
                                                </button>
                                            </li>
                                            {% if computational_data.concrete %}
                                            <li class="nav-item" role="presentation">
                                                <button class="nav-link" id="concrete-tab" data-bs-toggle="tab"
                                                    data-bs-target="#concrete" type="button">
                                                    <i class="fas fa-calculator me-1"></i> Concrete Math
                                                </button>
                                            </li>
                                            {% endif %}
                                            {% if computational_data.flow %}
                                            <li class="nav-item" role="presentation">
                                                <button class="nav-link" id="flow-tab" data-bs-toggle="tab"
                                                    data-bs-target="#flow" type="button">
                                                    <i class="fas fa-project-diagram me-1"></i> Full Flow
                                                </button>
                                            </li>
                                            {% endif %}
                                            {% if computational_data.detailed %}
                                            <li class="nav-item" role="presentation">
                                                <button class="nav-link" id="detailed-tab" data-bs-toggle="tab"
                                                    data-bs-target="#detailed" type="button">
                                                    <i class="fas fa-layer-group me-1"></i> Layer Details
                                                </button>
                                            </li>
                                            {% endif %}
                                            {% if computational_data.trace %}
                                            <li class="nav-item" role="presentation">
                                                <button class="nav-link" id="trace-tab" data-bs-toggle="tab"
                                                    data-bs-target="#trace" type="button">
                                                    <i class="fas fa-route me-1"></i> My Image Trace
                                                </button>
                                            </li>
                                            {% endif %}
                                        </ul>

                                        <!-- Tab Content -->
                                        <div class="tab-content" id="analysisTabContent">

                                            <!-- Summary Tab -->
                                            <div class="tab-pane fade show active" id="summary" role="tabpanel">
                                                <h6 class="fw-bold mb-3">
                                                    <i class="fas fa-equals me-2"></i>
                                                    Mathematical Computation Flow
                                                </h6>
                                                <div class="alert alert-info small mb-3">
                                                    <i class="fas fa-lightbulb me-2"></i>
                                                    This shows the actual mathematical equations and transformations
                                                    that convert your input image into a burn severity prediction.
                                                </div>

                                                <!-- Step-by-step mathematical flow -->
                                                <div class="math-flow">

                                                    <!-- Step 1: Input -->
                                                    <div class="card mb-3 border-primary">
                                                        <div class="card-header bg-primary text-white">
                                                            <strong>ðŸ“¥ Step 1: Input Image</strong>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="equation-box p-3 bg-light rounded mb-2">
                                                                <code>X<sub>input</sub> = Image(224 Ã— 224 Ã— 3)</code>
                                                            </div>
                                                            <p class="small mb-0">Your uploaded image is represented as
                                                                a 3D tensor with height, width, and RGB color channels.
                                                            </p>
                                                        </div>
                                                    </div>

                                                    <!-- Step 2: CNN Feature Extraction -->
                                                    <div class="card mb-3 border-success">
                                                        <div class="card-header bg-success text-white">
                                                            <strong>ðŸ”¬ Step 2: CNN Feature Extraction
                                                                (ResNet50)</strong>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="equation-box p-3 bg-light rounded mb-2">
                                                                <code>F<sub>CNN</sub> =
                                                                    ResNet50(X<sub>input</sub>)</code><br>
                                                                <code>F<sub>CNN</sub> =
                                                                    Conv(ReLU(BatchNorm(...Conv(X<sub>input</sub>))))</code><br>
                                                                <code>Shape: (7 Ã— 7 Ã— 2048)</code>
                                                            </div>
                                                            <p class="small mb-2"><strong>What CNN does:</strong></p>
                                                            <ul class="small mb-0">
                                                                <li><strong>Convolution</strong>: Applies 50 layers of
                                                                    filters to detect burn patterns, edges, textures
                                                                </li>
                                                                <li><strong>Formula</strong>: Output[i,j,k] = Î£(Input *
                                                                    Kernel) + Bias</li>
                                                                <li><strong>Result</strong>: 7Ã—7 grid with 2048 features
                                                                    per location = spatial feature map</li>
                                                            </ul>
                                                        </div>
                                                    </div>

                                                    <!-- Step 3: Reshape -->
                                                    <div class="card mb-3 border-info">
                                                        <div class="card-header bg-info text-white">
                                                            <strong>ðŸ”„ Step 3: Reshape to Sequence</strong>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="equation-box p-3 bg-light rounded mb-2">
                                                                <code>T<sub>tokens</sub> =
                                                                    Reshape(F<sub>CNN</sub>)</code><br>
                                                                <code>T<sub>tokens</sub> = (7 Ã— 7, 2048) â†’ (49 tokens,
                                                                    2048 features)</code>
                                                            </div>
                                                            <p class="small mb-2"><strong>What Reshape does:</strong>
                                                            </p>
                                                            <ul class="small mb-0">
                                                                <li>Flattens the spatial 7Ã—7 grid into a sequence of 49
                                                                    tokens</li>
                                                                <li>Each token represents one spatial location with 2048
                                                                    features</li>
                                                                <li>Prepares data for transformer processing</li>
                                                            </ul>
                                                        </div>
                                                    </div>

                                                    <!-- Step 4: Transformer Attention -->
                                                    <div class="card mb-3 border-warning">
                                                        <div class="card-header bg-warning text-dark">
                                                            <strong>ðŸ§  Step 4: Transformer Multi-Head Attention</strong>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="equation-box p-3 bg-light rounded mb-2">
                                                                <code>Q = T<sub>tokens</sub> Ã— W<sub>Q</sub>
                                                                    (Query)</code><br>
                                                                <code>K = T<sub>tokens</sub> Ã— W<sub>K</sub>
                                                                    (Key)</code><br>
                                                                <code>V = T<sub>tokens</sub> Ã— W<sub>V</sub>
                                                                    (Value)</code><br><br>
                                                                <code>Attention(Q,K,V) = softmax(Q Ã— K<sup>T</sup> /
                                                                    âˆšd<sub>k</sub>) Ã— V</code><br><br>
                                                                <code>T<sub>attended</sub> =
                                                                    MultiHead(T<sub>tokens</sub>) + T<sub>tokens</sub>
                                                                    (Residual)</code>
                                                            </div>
                                                            <p class="small mb-2"><strong>What Transformer
                                                                    does:</strong></p>
                                                            <ul class="small mb-0">
                                                                <li><strong>Self-Attention</strong>: Learns which burn
                                                                    regions relate to each other</li>
                                                                <li><strong>Multi-Head</strong>: Uses 4 parallel
                                                                    attention mechanisms (4 heads)</li>
                                                                <li><strong>2 Blocks</strong>: Applies attention twice
                                                                    for deeper relationships</li>
                                                                <li><strong>Result</strong>: Tokens with contextual
                                                                    understanding of the entire burn area</li>
                                                            </ul>
                                                        </div>
                                                    </div>

                                                    <!-- Step 5: Global Average Pooling -->
                                                    <div class="card mb-3 border-secondary">
                                                        <div class="card-header bg-secondary text-white">
                                                            <strong>ðŸ“Š Step 5: Global Average Pooling</strong>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="equation-box p-3 bg-light rounded mb-2">
                                                                <code>F<sub>pooled</sub> = (1/49) Ã— Î£<sub>i=1...49</sub>
                                                                    T<sub>attended</sub>[i]</code><br>
                                                                <code>Shape: (2048,) â€” Single feature vector</code>
                                                            </div>
                                                            <p class="small mb-2"><strong>What Pooling does:</strong>
                                                            </p>
                                                            <ul class="small mb-0">
                                                                <li>Averages all 49 token representations into one
                                                                    vector</li>
                                                                <li>Creates a global representation of the entire burn
                                                                </li>
                                                                <li>Reduces (49 Ã— 2048) â†’ (2048) dimensional vector</li>
                                                            </ul>
                                                        </div>
                                                    </div>

                                                    <!-- Step 6: Classification -->
                                                    <div class="card mb-3 border-danger">
                                                        <div class="card-header bg-danger text-white">
                                                            <strong>ðŸŽ¯ Step 6: Classification (Dense + Softmax)</strong>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="equation-box p-3 bg-light rounded mb-2">
                                                                <code>Logits = F<sub>pooled</sub> Ã— W<sub>dense</sub> +
                                                                    b</code><br>
                                                                <code>Logits = (2048,) Ã— (2048, 5) + (5,) =
                                                                    (5,)</code><br><br>
                                                                <code>P(class<sub>i</sub>) = exp(logit<sub>i</sub>) /
                                                                    Î£<sub>j=1...5</sub>
                                                                    exp(logit<sub>j</sub>)</code><br><br>
                                                                <code>Prediction = argmax(P)</code>
                                                            </div>
                                                            <p class="small mb-2"><strong>What Classification
                                                                    does:</strong></p>
                                                            <ul class="small mb-2">
                                                                <li><strong>Dense Layer</strong>: Linear transformation
                                                                    to 5 class scores (logits)</li>
                                                                <li><strong>Softmax</strong>: Converts logits to
                                                                    probabilities that sum to 1</li>
                                                                <li><strong>ArgMax</strong>: Selects the class with
                                                                    highest probability</li>
                                                            </ul>
                                                            {% if computational_data.detailed and computational_data.detailed.logits %}
                                                            <div
                                                                class="p-3 bg-warning bg-opacity-10 rounded border border-warning">
                                                                <p class="small mb-2"><strong>ðŸ“Š Your Image's
                                                                        Logits:</strong></p>
                                                                <ul class="small mb-0">
                                                                    {% for class_name, logit_value in computational_data.detailed.logits.items() %}
                                                                    <li>{{ class_name }}:
                                                                        <code>{{ "%.4f"|format(logit_value) }}</code>
                                                                    </li>
                                                                    {% endfor %}
                                                                </ul>
                                                            </div>
                                                            {% endif %}
                                                        </div>
                                                    </div>

                                                    <!-- Final Result -->
                                                    <div class="card border-primary">
                                                        <div class="card-header bg-primary text-white">
                                                            <strong>âœ… Final Result</strong>
                                                        </div>
                                                        <div class="card-body">
                                                            <div
                                                                class="equation-box p-3 bg-success bg-opacity-10 rounded border border-success mb-2">
                                                                <code class="text-success fs-5">Burn Severity =
                                                                    {{ result.predicted_class }}</code><br>
                                                                <code class="text-success">Confidence =
                                                                    {{ "%.2f"|format(result.confidence * 100) }}%</code>
                                                            </div>
                                                            <p class="small mb-2"><strong>Complete Mathematical
                                                                    Flow:</strong></p>
                                                            <div class="p-3 bg-light rounded">
                                                                <code class="small">
                                                                    Image â†’ CNN â†’ Reshape â†’ Transformer â†’ Pool â†’ Dense â†’
                                                                    Softmax â†’ Prediction
                                                                    <br><br>
                                                                    {{ result.predicted_class }} =
                                                                    argmax(softmax(Dense(Pool(Transformer(Reshape(CNN(Image)))))))
                                                                </code>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>

                                            <!-- Concrete Math Tab -->
                                            {% if computational_data.concrete %}
                                            <div class="tab-pane fade" id="concrete" role="tabpanel">
                                                <h6 class="fw-bold mb-3">
                                                    <i class="fas fa-calculator me-2"></i>
                                                    Actual Numerical Computations with Real Weights
                                                </h6>
                                                <div class="alert alert-info small mb-3">
                                                    <i class="fas fa-info-circle me-2"></i>
                                                    This shows actual mathematical operations with real model weights
                                                    and values at each computation step.
                                                </div>

                                                {% for step in computational_data.concrete %}
                                                <div class="card mb-3 border-start border-primary border-3">
                                                    <div class="card-header bg-light">
                                                        <strong class="text-primary">{{ step.step }}</strong>
                                                    </div>
                                                    <div class="card-body">
                                                        {% if step.operation %}
                                                        <p class="mb-2"><strong>Operation:</strong>
                                                            <code>{{ step.operation }}</code></p>
                                                        {% endif %}

                                                        {% if step.input_shape %}
                                                        <p class="mb-2"><strong>Input Shape:</strong>
                                                            {{ step.input_shape }}</p>
                                                        {% endif %}

                                                        {% if step.output_shape %}
                                                        <p class="mb-2"><strong>Output Shape:</strong>
                                                            {{ step.output_shape }}</p>
                                                        {% endif %}

                                                        {% if step.sample_weights %}
                                                        <div class="mb-2">
                                                            <strong>Sample Weights:</strong>
                                                            <pre class="bg-light p-2 rounded small mb-0"
                                                                style="max-height: 150px; overflow-y: auto;"><code>{{ step.sample_weights }}</code></pre>
                                                        </div>
                                                        {% endif %}

                                                        {% if step.computation_example %}
                                                        <div class="mb-2">
                                                            <strong>Computation Example:</strong>
                                                            <pre class="bg-light p-2 rounded small mb-0"
                                                                style="max-height: 150px; overflow-y: auto;"><code>{{ step.computation_example }}</code></pre>
                                                        </div>
                                                        {% endif %}

                                                        {% if step.sample_output %}
                                                        <div class="mb-2">
                                                            <strong>Sample Output Values:</strong>
                                                            <pre class="bg-light p-2 rounded small mb-0"
                                                                style="max-height: 100px; overflow-y: auto;"><code>{{ step.sample_output }}</code></pre>
                                                        </div>
                                                        {% endif %}

                                                        {% if step.statistics %}
                                                        <div class="row g-2 mt-2">
                                                            {% for stat_name, stat_value in step.statistics.items() %}
                                                            <div class="col-md-6">
                                                                <div class="p-2 bg-light rounded small">
                                                                    <strong>{{ stat_name }}:</strong>
                                                                    {{ "%.4f"|format(stat_value) if stat_value is number else stat_value }}
                                                                </div>
                                                            </div>
                                                            {% endfor %}
                                                        </div>
                                                        {% endif %}

                                                        <!-- If none of the structured fields exist, show raw JSON -->
                                                        {% if not step.operation and not step.input_shape and not step.output_shape %}
                                                        <pre class="bg-light p-2 rounded small mb-0"
                                                            style="max-height: 200px; overflow-y: auto;"><code>{{ step | tojson(indent=2) }}</code></pre>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                                {% endfor %}
                                            </div>
                                            {% endif %}

                                            <!-- Full Flow Tab -->
                                            {% if computational_data.flow %}
                                            <div class="tab-pane fade" id="flow" role="tabpanel">
                                                <h6 class="fw-bold mb-3">
                                                    <i class="fas fa-project-diagram me-2"></i>
                                                    Complete Computational Flow
                                                </h6>

                                                <!-- Summary Card -->
                                                <div class="card mb-3 border-primary">
                                                    <div class="card-header bg-primary text-white">
                                                        <strong><i class="fas fa-chart-bar me-2"></i>Flow
                                                            Summary</strong>
                                                    </div>
                                                    <div class="card-body">
                                                        <div class="row g-3">
                                                            <div class="col-md-4">
                                                                <div class="p-2 bg-light rounded text-center">
                                                                    <small class="text-muted d-block">Total
                                                                        Steps</small>
                                                                    <strong
                                                                        class="fs-4">{{ computational_data.flow.summary.total_steps }}</strong>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-4">
                                                                <div class="p-2 bg-light rounded text-center">
                                                                    <small class="text-muted d-block">Prediction</small>
                                                                    <strong
                                                                        class="text-primary">{{ computational_data.flow.summary.predicted_class }}</strong>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-4">
                                                                <div class="p-2 bg-light rounded text-center">
                                                                    <small class="text-muted d-block">Confidence</small>
                                                                    <strong
                                                                        class="fs-4 text-success">{{ "%.2f"|format(computational_data.flow.summary.confidence * 100) }}%</strong>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Computation Steps Accordion -->
                                                <div class="accordion" id="flowAccordion">
                                                    {% for log_entry in computational_data.flow.computation_log %}
                                                    <div class="accordion-item mb-2 border">
                                                        <h2 class="accordion-header" id="flowHeading{{ loop.index }}">
                                                            <button class="accordion-button collapsed" type="button"
                                                                data-bs-toggle="collapse"
                                                                data-bs-target="#flow{{ loop.index }}"
                                                                aria-expanded="false"
                                                                aria-controls="flow{{ loop.index }}">
                                                                <div class="d-flex align-items-center w-100">
                                                                    <span class="badge bg-primary me-2">Step
                                                                        {{ loop.index }}</span>
                                                                    <strong>{{ log_entry.step }}</strong>
                                                                </div>
                                                            </button>
                                                        </h2>
                                                        <div id="flow{{ loop.index }}" class="accordion-collapse collapse"
                                                            aria-labelledby="flowHeading{{ loop.index }}"
                                                            data-bs-parent="#flowAccordion">
                                                            <div class="accordion-body">
                                                                {% if log_entry.details %}
                                                                {% if log_entry.details is mapping %}
                                                                <dl class="row mb-0">
                                                                    {% for key, value in log_entry.details.items() %}
                                                                    <dt class="col-sm-3 text-muted">{{ key }}</dt>
                                                                    <dd class="col-sm-9">
                                                                        {% if value is mapping or value is sequence %}
                                                                        <pre class="bg-light p-2 rounded small mb-0"
                                                                            style="max-height: 200px; overflow-y: auto;"><code>{{ value | tojson(indent=2) }}</code></pre>
                                                                        {% else %}
                                                                        <code>{{ value }}</code>
                                                                        {% endif %}
                                                                    </dd>
                                                                    {% endfor %}
                                                                </dl>
                                                                {% else %}
                                                                <pre class="bg-light p-2 rounded small mb-0"
                                                                    style="max-height: 300px; overflow-y: auto;"><code>{{ log_entry.details | tojson(indent=2) }}</code></pre>
                                                                {% endif %}
                                                                {% else %}
                                                                <p class="text-muted mb-0">No detailed information
                                                                    available for this step.</p>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                            {% endif %}

                                            <!-- Detailed Analysis Tab -->
                                            {% if computational_data.detailed %}
                                            <div class="tab-pane fade" id="detailed" role="tabpanel">
                                                <h6 class="fw-bold mb-3">Layer-by-Layer Analysis</h6>

                                                <!-- CNN Features -->
                                                {% if computational_data.detailed.cnn_features %}
                                                <div class="mb-3">
                                                    <strong class="text-primary">CNN Features</strong>
                                                    <div class="p-2 bg-light rounded small">
                                                        <p class="mb-1"><strong>Shape:</strong>
                                                            {{ computational_data.detailed.cnn_features.shape }}</p>
                                                        <p class="mb-1"><strong>Mean Activation:</strong>
                                                            {{ "%.4f"|format(computational_data.detailed.cnn_features.mean_activation) }}
                                                        </p>
                                                        <p class="mb-0"><strong>Max Activation:</strong>
                                                            {{ "%.4f"|format(computational_data.detailed.cnn_features.max_activation) }}
                                                        </p>
                                                    </div>
                                                </div>
                                                {% endif %}

                                                <!-- Transformer Attention -->
                                                {% if computational_data.detailed.transformer_attention %}
                                                <div class="mb-3">
                                                    <strong class="text-info">Transformer Attention</strong>
                                                    {% for block in computational_data.detailed.transformer_attention %}
                                                    <div class="p-2 bg-light rounded small mb-2">
                                                        <p class="mb-1"><strong>Block {{ block.block }}:</strong></p>
                                                        <p class="mb-1">Mean Attention:
                                                            {{ "%.4f"|format(block.mean_attention) }}
                                                        </p>
                                                        <p class="mb-0">Attention Strength:
                                                            {{ "%.4f"|format(block.attention_strength) }}
                                                        </p>
                                                    </div>
                                                    {% endfor %}
                                                </div>
                                                {% endif %}

                                                <!-- Logits -->
                                                {% if computational_data.detailed.logits %}
                                                <div class="mb-3">
                                                    <strong class="text-danger">Classification Logits</strong>
                                                    <div class="p-2 bg-light rounded small">
                                                        {% for class_name, logit_value in computational_data.detailed.logits.items() %}
                                                        <p class="mb-1">{{ class_name }}:
                                                            {{ "%.4f"|format(logit_value) }}</p>
                                                        {% endfor %}
                                                    </div>
                                                </div>
                                                {% endif %}
                                            </div>
                                            {% endif %}

                                            <!-- My Image Trace Tab -->
                                            {% if computational_data.trace %}
                                            <div class="tab-pane fade" id="trace" role="tabpanel">
                                                <h6 class="fw-bold mb-3">
                                                    <i class="fas fa-route me-2"></i>
                                                    YOUR IMAGE - Step-by-Step Computation Trace
                                                </h6>
                                                <div class="alert alert-success small mb-3">
                                                    <i class="fas fa-camera me-2"></i>
                                                    This shows the <strong>actual numerical values from YOUR uploaded
                                                        image</strong> being transformed at each layer of the network.
                                                    You can see exactly how your specific image is processed!
                                                </div>

                                                {% for step in computational_data.trace.steps %}
                                                <div
                                                    class="card mb-3 {% if step.step_number == 0 %}border-primary{% elif step.step_number < 3 %}border-success{% elif step.step_number < 6 %}border-info{% elif step.step_number < 10 %}border-warning{% else %}border-danger{% endif %}">
                                                    <div
                                                        class="card-header {% if step.step_number == 0 %}bg-primary text-white{% elif step.step_number < 3 %}bg-success text-white{% elif step.step_number < 6 %}bg-info text-white{% elif step.step_number < 10 %}bg-warning text-dark{% else %}bg-danger text-white{% endif %}">
                                                        <strong>
                                                            {% if step.step_number == 0 %}ðŸ“¸
                                                            {% elif step.step_number < 3 %}ðŸ”¬
                                                            {% elif step.step_number < 6 %}ðŸ”„
                                                            {% elif step.step_number < 10 %}ðŸ§ 
                                                            {% else %}ðŸŽ¯
                                                            {% endif %}
                                                            Step {{ step.step_number }}: {{ step.step_name }}
                                                        </strong>
                                                    </div>
                                                    <div class="card-body">
                                                        <p class="small text-muted mb-2"><strong>Operation:</strong>
                                                            {{ step.operation }}</p>

                                                        {% if step.layer_name %}
                                                        <p class="small mb-2"><strong>Layer:</strong>
                                                            <code>{{ step.layer_name }}</code></p>
                                                        {% endif %}

                                                        {% if step.input_shape and step.output_shape %}
                                                        <p class="small mb-2">
                                                            <strong>Shape Transform:</strong>
                                                            <code>{{ step.input_shape }}</code> â†’
                                                            <code>{{ step.output_shape }}</code>
                                                        </p>
                                                        {% endif %}

                                                        <!-- Pixel Samples for Input Step -->
                                                        {% if step.samples and step.step_number == 0 %}
                                                        <div class="mt-2">
                                                            <strong class="small">Sample Pixel Values from YOUR
                                                                Image:</strong>
                                                            <div class="table-responsive mt-2">
                                                                <table class="table table-sm table-bordered small">
                                                                    <thead class="table-light">
                                                                        <tr>
                                                                            <th>Location</th>
                                                                            <th>Position</th>
                                                                            <th>Red</th>
                                                                            <th>Green</th>
                                                                            <th>Blue</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        {% for sample in step.samples %}
                                                                        <tr>
                                                                            <td>{{ sample.location }}</td>
                                                                            <td><code>{{ sample.position }}</code></td>
                                                                            <td>{{ "%.1f"|format(sample.RGB_values[0]) }}
                                                                            </td>
                                                                            <td>{{ "%.1f"|format(sample.RGB_values[1]) }}
                                                                            </td>
                                                                            <td>{{ "%.1f"|format(sample.RGB_values[2]) }}
                                                                            </td>
                                                                        </tr>
                                                                        {% endfor %}
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                        {% endif %}

                                                        <!-- CNN/Transformer/Pooling Samples -->
                                                        {% if step.samples and step.step_number > 0 and step.step_number < 15 %}
                                                        <div class="mt-2">
                                                            <strong class="small">Sample Output Values:</strong>
                                                            <div class="p-2 bg-light rounded mt-2">
                                                                {% for sample in step.samples[:3] %}
                                                                <div class="mb-2 small">
                                                                    {% if sample.position %}
                                                                    <code>{{ sample.position }}</code>:
                                                                    {% elif sample.spatial_position %}
                                                                    <code>{{ sample.spatial_position }}</code>:
                                                                    {% elif sample.token_index is defined %}
                                                                    Token {{ sample.token_index }}:
                                                                    {% endif %}

                                                                    {% if sample.filter_outputs %}
                                                                    [{{ sample.filter_outputs|map('round', 2)|join(', ') }}]
                                                                    {% elif sample.top_5_values %}
                                                                    Top features:
                                                                    [{{ sample.top_5_values|map('round', 2)|join(', ') }}]
                                                                    {% elif sample.sample_values %}
                                                                    [{{ sample.sample_values|map('round', 4)|join(', ') }}]
                                                                    {% elif sample.mean_attention is defined %}
                                                                    Mean:
                                                                    {{ "%.4f"|format(sample.mean_attention) }}
                                                                    {% endif %}
                                                                </div>
                                                                {% endfor %}
                                                            </div>
                                                        </div>
                                                        {% endif %}

                                                        <!-- Top Features for Pooling Step -->
                                                        {% if step.top_20_features %}
                                                        <div class="mt-2">
                                                            <strong class="small">Top 20 Features (highest
                                                                values):</strong>
                                                            <div class="p-2 bg-light rounded mt-2 small"
                                                                style="max-height: 200px; overflow-y: auto;">
                                                                {% for i in range(step.top_20_features['indices'][:10]|length) %}
                                                                <div>Feature
                                                                    {{ step.top_20_features['indices'][i] }}:
                                                                    {{ "%.4f"|format(step.top_20_features['values'][i]) }}
                                                                </div>
                                                                {% endfor %}
                                                            </div>
                                                        </div>
                                                        {% endif %}

                                                        <!-- Final Probabilities -->
                                                        {% if step.probabilities %}
                                                        <div class="mt-3">
                                                            <strong class="small">Final Class Probabilities from YOUR
                                                                Image:</strong>
                                                            <div class="mt-2">
                                                                {% for class_name, prob in step.probabilities.items() %}
                                                                <div class="d-flex align-items-center mb-2">
                                                                    <span class="small me-2"
                                                                        style="width: 180px;">{{ class_name }}:</span>
                                                                    <div class="progress flex-grow-1"
                                                                        style="height: 20px;">
                                                                        <div class="progress-bar {% if loop.index0 == result.class_id %}bg-success{% else %}bg-secondary{% endif %}"
                                                                            style="width: {{ (prob * 100)|round(2) }}%">
                                                                            {{ (prob * 100)|round(2) }}%
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                {% endfor %}
                                                            </div>
                                                        </div>
                                                        {% endif %}

                                                        <!-- Statistics -->
                                                        {% if step.statistics %}
                                                        <div class="mt-3 p-2 bg-light rounded">
                                                            <strong class="small">Statistics:</strong>
                                                            <div class="small">
                                                                Min:
                                                                {{ "%.4f"|format(step.statistics.min) }}
                                                                |
                                                                Max:
                                                                {{ "%.4f"|format(step.statistics.max) }}
                                                                |
                                                                Mean:
                                                                {{ "%.4f"|format(step.statistics.mean) }}
                                                                |
                                                                Std:
                                                                {{ "%.4f"|format(step.statistics.std) }}
                                                            </div>
                                                        </div>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                                {% endfor %}

                                                <div class="alert alert-info small mt-3">
                                                    <i class="fas fa-info-circle me-2"></i>
                                                    <strong>What you're seeing:</strong> These are the actual numerical
                                                    values extracted from YOUR specific uploaded image. Each step shows
                                                    how your image data is transformed - from raw pixel values to the
                                                    final burn severity prediction. The numbers you see are unique to
                                                    your image!
                                                </div>
                                            </div>
                                            {% endif %}

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Debug Info (hidden by default) -->
                        <div class="alert alert-secondary mt-3" id="debugInfo" style="display:none;" role="alert">
                            <strong>DEBUG:</strong><br>
                            image_path: {{ image_path }}<br>
                            overlay_path: {{ overlay_path }}<br>
                            Model Prediction: {{ result.predicted_class }}<br>
                            Confidence: {{ "%.2f"|format(result.confidence * 100) }}%<br>
                            Probabilities: {{ result.all_probabilities }}<br>
                        </div>

                        <!-- Primary Classification Results Section -->
                        <section class="clinical-assessment mt-5">
                            <!-- Compact Header -->
                            <div class="assessment-header">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="severity-indicator-compact
                                        {% if result.class_id == 4 %}severity-normal
                                        {% elif result.class_id == 0 %}severity-first
                                        {% elif result.class_id == 1 %}severity-second
                                        {% elif result.class_id == 2 %}severity-third
                                        {% else %}severity-fourth
                                        {% endif %}">
                                        {% if result.class_id == 4 %}
                                        <i class="fas fa-thumbs-up"></i>
                                        {% elif result.class_id == 0 %}
                                        <i class="fas fa-leaf"></i>
                                        {% elif result.class_id == 1 %}
                                        <i class="fas fa-fire"></i>
                                        {% elif result.class_id == 2 %}
                                        <i class="fas fa-exclamation-triangle"></i>
                                        {% else %}
                                        <i class="fas fa-skull-crossbones"></i>
                                        {% endif %}
                                    </div>
                                    <div>
                                        <h3 class="assessment-title">Clinical Assessment</h3>
                                        <p class="assessment-subtitle">Professional medical analysis and care
                                            recommendations</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Main Content Grid -->
                            <div class="clinical-grid">

                                <!-- Diagnosis Card - Full Width, Prominent -->
                                <div class="diagnosis-card">
                                    <div class="diagnosis-header">
                                        <div class="d-flex align-items-center justify-content-between">
                                            <div class="d-flex align-items-center gap-3">
                                                <div class="diagnosis-icon">
                                                    {% if result.class_id == 4 %}
                                                    <i class="fas fa-thumbs-up"></i>
                                                    {% elif result.class_id == 0 %}
                                                    <i class="fas fa-leaf"></i>
                                                    {% elif result.class_id == 1 %}
                                                    <i class="fas fa-fire"></i>
                                                    {% elif result.class_id == 2 %}
                                                    <i class="fas fa-exclamation-triangle"></i>
                                                    {% else %}
                                                    <i class="fas fa-skull-crossbones"></i>
                                                    {% endif %}
                                                </div>
                                                <div>
                                                    <h4 class="diagnosis-title-main">
                                                        {% if result.class_id == 4 %}Normal Skin / No Burn Detected
                                                        {% elif result.class_id == 0 %}First-Degree Burn (Superficial)
                                                        {% elif result.class_id == 1 %}Second-Degree Burn (Partial
                                                        Thickness)
                                                        {% elif result.class_id == 2 %}Third-Degree Burn (Full
                                                        Thickness)
                                                        {% else %}Fourth-Degree Burn (Deep Full Thickness)
                                                        {% endif %}
                                                    </h4>
                                                    <p class="diagnosis-classification">Burn Severity Classification</p>
                                                </div>
                                            </div>
                                            <div class="urgency-indicator
                                                {% if result.class_id == 4 %}urgency-none
                                                {% elif result.class_id == 0 %}urgency-low
                                                {% elif result.class_id == 1 %}urgency-moderate
                                                {% elif result.class_id == 2 %}urgency-high
                                                {% else %}urgency-critical
                                                {% endif %}">
                                                <span class="urgency-text">
                                                    {% if result.class_id == 4 %}No Urgency
                                                    {% elif result.class_id == 0 %}Low Urgency
                                                    {% elif result.class_id == 1 %}Moderate Urgency
                                                    {% elif result.class_id == 2 %}High Urgency
                                                    {% else %}Critical Emergency
                                                    {% endif %}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="diagnosis-content">
                                        <p class="diagnosis-description">
                                            {% if result.class_id == 4 %}No signs of thermal injury identified. Skin
                                            appears healthy and intact with normal color and texture.
                                            {% elif result.class_id == 0 %}Affects only the epidermis (outer skin
                                            layer). Characterized by redness, mild pain, and dry skin. Typically heals
                                            within 3-7 days without scarring.
                                            {% elif result.class_id == 1 %}Involves both epidermis and dermis layers.
                                            May present with blistering, severe pain, and swelling. Requires careful
                                            monitoring for infection and proper wound care.
                                            {% elif result.class_id == 2 %}Destroys all layers of skin and may affect
                                            deeper tissues. Appears white, charred, or leathery. Requires immediate
                                            medical intervention and surgical treatment.
                                            {% else %}Life-threatening injury extending through skin into muscle, bone,
                                            and internal structures. Requires immediate emergency surgery and intensive
                                            care management.
                                            {% endif %}
                                        </p>
                                    </div>
                                </div>

                                <!-- Treatment Protocol Grid -->
                                <div class="treatment-grid">

                                    <!-- Immediate Care Card -->
                                    <div class="treatment-card immediate-care">
                                        <div class="treatment-card-header">
                                            <div class="treatment-icon success">
                                                <i class="fas fa-hand-holding-medical"></i>
                                            </div>
                                            <h5 class="treatment-card-title">Immediate Care</h5>
                                        </div>
                                        <ul class="treatment-steps">
                                            {% if result.class_id == 4 %}
                                            <li class="treatment-step">Continue normal skin care routine</li>
                                            <li class="treatment-step">Monitor for any changes or irritation</li>
                                            <li class="treatment-step">Maintain proper skin hydration</li>
                                            <li class="treatment-step">Apply sunscreen if exposed to UV</li>
                                            {% elif result.class_id == 0 %}
                                            <li class="treatment-step">Cool with running water for 10-15 minutes</li>
                                            <li class="treatment-step">Apply aloe vera gel or cool compress</li>
                                            <li class="treatment-step">Take over-the-counter pain relief if needed</li>
                                            <li class="treatment-step">Keep the area clean and moisturized</li>
                                            {% elif result.class_id == 1 %}
                                            <li class="treatment-step">Cool with water for 15-20 minutes</li>
                                            <li class="treatment-step">Apply sterile, non-adherent dressing</li>
                                            <li class="treatment-step">Elevate affected area if possible</li>
                                            <li class="treatment-step">Monitor for signs of infection</li>
                                            {% elif result.class_id == 2 %}
                                            <li class="treatment-step">Cover with clean, dry cloth</li>
                                            <li class="treatment-step">Call emergency services immediately</li>
                                            <li class="treatment-step">Monitor vital signs and breathing</li>
                                            <li class="treatment-step">Prepare for emergency transport</li>
                                            {% else %}
                                            <li class="treatment-step">Call 911 / emergency services now</li>
                                            <li class="treatment-step">Cover loosely with sterile cloth</li>
                                            <li class="treatment-step">Monitor breathing and circulation</li>
                                            <li class="treatment-step">Prepare for immediate transport</li>
                                            {% endif %}
                                        </ul>
                                    </div>

                                    <!-- Avoid Actions Card -->
                                    <div class="treatment-card avoid-actions">
                                        <div class="treatment-card-header">
                                            <div class="treatment-icon danger">
                                                <i class="fas fa-exclamation-triangle"></i>
                                            </div>
                                            <h5 class="treatment-card-title">Avoid These Actions</h5>
                                        </div>
                                        <ul class="treatment-steps">
                                            {% if result.class_id == 4 %}
                                            <li class="treatment-step">No specific restrictions needed</li>
                                            <li class="treatment-step">Avoid harsh or irritating products</li>
                                            <li class="treatment-step">Don't over-treat normal skin</li>
                                            <li class="treatment-step">Avoid excessive scrubbing or friction</li>
                                            {% elif result.class_id == 0 %}
                                            <li class="treatment-step">Don't apply ice directly to skin</li>
                                            <li class="treatment-step">Avoid breaking any blisters that form</li>
                                            <li class="treatment-step">Don't use butter, oils, or home remedies</li>
                                            <li class="treatment-step">Avoid petroleum-based products</li>
                                            {% elif result.class_id == 1 %}
                                            <li class="treatment-step">Never pop or drain blisters</li>
                                            <li class="treatment-step">Avoid ice or very cold water</li>
                                            <li class="treatment-step">Don't use adhesive bandages on burn</li>
                                            <li class="treatment-step">Avoid cotton or fluffy materials</li>
                                            {% elif result.class_id == 2 %}
                                            <li class="treatment-step">Don't remove stuck clothing/debris</li>
                                            <li class="treatment-step">Avoid ice, ointments, or creams</li>
                                            <li class="treatment-step">Don't immerse in water</li>
                                            <li class="treatment-step">Never attempt home treatment</li>
                                            {% else %}
                                            <li class="treatment-step">Don't attempt any home treatment</li>
                                            <li class="treatment-step">Never remove embedded materials</li>
                                            <li class="treatment-step">Avoid any topical treatments</li>
                                            <li class="treatment-step">Don't delay emergency care</li>
                                            {% endif %}
                                        </ul>
                                    </div>

                                    <!-- Medical Decision Card -->
                                    <div class="treatment-card medical-decision">
                                        <div class="treatment-card-header">
                                            <div class="treatment-icon info">
                                                <i class="fas fa-user-md"></i>
                                            </div>
                                            <h5 class="treatment-card-title">When to Seek Medical Care</h5>
                                        </div>
                                        <div class="medical-recommendation">
                                            {% if result.class_id == 4 %}
                                            <div class="recommendation-level level-none">
                                                <h6 class="recommendation-title">No Medical Intervention Required</h6>
                                                <p class="recommendation-text">No emergent actions needed. Continue
                                                    routine skin care. Consult a
                                                    dermatologist if you notice any unusual changes, persistent
                                                    irritation, or new lesions that don't heal normally.</p>
                                            </div>
                                            {% elif result.class_id == 0 %}
                                            <div class="recommendation-level level-monitor">
                                                <h6 class="recommendation-title">Self-Care with Monitoring</h6>
                                                <p class="recommendation-text">Most first-degree burns heal on their
                                                    own. <strong>Seek medical care if:</strong> pain increases
                                                    significantly, burn covers area larger than your palm, signs of
                                                    infection appear, or healing doesn't progress after 3-5 days.</p>
                                            </div>
                                            {% elif result.class_id == 1 %}
                                            <div class="recommendation-level level-caution">
                                                <h6 class="recommendation-title">Medical Evaluation Recommended</h6>
                                                <p class="recommendation-text"><strong>See a healthcare provider
                                                        if:</strong> burn is larger than 3 inches, located on
                                                    face/hands/feet/genitals, shows signs of infection (increased pain,
                                                    pus, red streaking), or if you have diabetes/immune compromise.</p>
                                            </div>
                                            {% elif result.class_id == 2 %}
                                            <div class="recommendation-level level-urgent">
                                                <h6 class="recommendation-title">Emergency Medical Care Required</h6>
                                                <p class="recommendation-text"><strong>Go to emergency room
                                                        immediately.</strong> Third-degree burns always require
                                                    professional medical treatment, wound debridement, and may need skin
                                                    grafting. Do not delay seeking care.</p>
                                            </div>
                                            {% else %}
                                            <div class="recommendation-level level-critical">
                                                <h6 class="recommendation-title">Call Emergency Services Now</h6>
                                                <p class="recommendation-text"><strong>This is a life-threatening
                                                        emergency.</strong> Fourth-degree burns require immediate
                                                    surgical intervention and intensive care. Call 911 or emergency
                                                    services immediately and prepare for emergency transport.</p>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </section>
                        <!-- Emergency and Medical Guidance Section -->
                        <section class="mb-4 mt-4">
                            <div class="info-card p-4 rounded-4 shadow-sm"
                                style="background: linear-gradient(135deg, #fffbe6 0%, #ffeaea 100%);">
                                <div class="d-flex align-items-center mb-3">
                                    <span class="info-icon me-3"><i
                                            class="fas fa-ambulance text-danger fa-lg"></i></span>
                                    <h5 class="fw-bold mb-0 text-dark">Emergency & Medical Guidance (Philippines)</h5>
                                </div>
                                <div class="mb-2">
                                    <strong>Essential Emergency Contacts:</strong>
                                    <ul class="mb-2">
                                        <li><strong>National Emergency Hotline:</strong> <span
                                                class="text-danger">911</span>
                                        </li>
                                        <li><strong>Philippine Red Cross:</strong> <span class="text-primary">143</span>
                                            or
                                            local chapter</li>
                                        <li><strong>Department of Health (DOH):</strong> <span class="text-primary">(02)
                                                8651-7800</span></li>
                                    </ul>
                                </div>
                                <div class="mb-2">
                                    <strong>Emergency Assessment Indicators:</strong>
                                    <ul class="mb-2">
                                        <li>Burns covering large areas or critical locations (face, hands, feet,
                                            genitals).</li>
                                        <li>Signs of shock (pale, clammy skin, rapid pulse).</li>
                                        <li>Difficulty breathing, burns to airway, or unconsciousness.</li>
                                    </ul>
                                </div>
                                <div class="mb-2">
                                    <strong>First Aid Instructions:</strong>
                                    <ul class="mb-2">
                                        <li>Call <strong>911</strong> immediately for severe burns or emergencies.</li>
                                        <li>Remove the person from the source of the burn.</li>
                                        <li>Cool the burn with clean running water (not ice) for 10-20 minutes.</li>
                                        <li>Cover with a clean, non-stick bandage or cloth.</li>
                                        <li>Do <strong>not</strong> apply ointments, butter, or home remedies.</li>
                                    </ul>
                                </div>
                                <div>
                                    <strong>When to See a Healthcare Provider:</strong>
                                    <ul>
                                        <li>If the burn is deep, large, or on sensitive areas.</li>
                                        <li>If there are signs of infection (pus, increased pain, redness, fever).</li>
                                        <li>If healing does not progress or if in doubt, seek medical advice at the
                                            nearest
                                            hospital or clinic.</li>
                                    </ul>
                                </div>
                                <div class="mt-3">
                                    <strong>Tip:</strong> For emergencies, stay calm and provide clear information when
                                    calling for help. Know your location and follow instructions from responders.
                                </div>
                            </div>
                        </section>

                        <!-- Action Buttons -->
                        <div class="row mt-4">
                            <div class="col-12 d-flex justify-content-center">
                                <a href="{{ url_for('index') }}"
                                    class="btn-custom btn-primary d-flex flex-row align-items-center justify-content-center"
                                    style="width: 50%; max-width: 320px; min-width: 180px;">
                                    <span class="btn-icon me-1"><i class="fas fa-check-circle"></i></span>
                                    <span class="btn-text text-center w-100">Finish</span>
                                </a>
                            </div>
                        </div>

                        <!-- Disclaimer -->
                        <section class="disclaimer-section mt-5">
                            <div class="disclaimer-card">
                                <div class="disclaimer-icon">
                                    <i class="fas fa-shield-alt"></i>
                                </div>
                                <div class="disclaimer-content">
                                    <h6 class="disclaimer-title">Medical Disclaimer</h6>
                                    <p class="disclaimer-text">
                                        This AI tool is designed for educational and research purposes only. It should
                                        not be used as a substitute for professional medical diagnosis or treatment.
                                        Always consult qualified healthcare professionals for medical assessment and
                                        care.
                                    </p>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        // Toggle for Attention Map (Grad-CAM)
        document.getElementById('debugToggle').addEventListener('change', function () {
            const debugInfo = document.getElementById('debugInfo');
            const gradcamSection = document.getElementById('gradcamSection');
            if (this.checked) {
                debugInfo.style.display = '';
                gradcamSection.style.display = '';
            } else {
                debugInfo.style.display = 'none';
                gradcamSection.style.display = 'none';
            }
        });

        // Toggle for Computational Flow
        {
            %
            if computational_data %
        }
        const computationalToggle = document.getElementById('computationalToggle');
        if (computationalToggle) {
            computationalToggle.addEventListener('change', function () {
                const computationalSection = document.getElementById('computationalSection');
                if (this.checked) {
                    computationalSection.style.display = '';
                } else {
                    computationalSection.style.display = 'none';
                }
            });
        } {
            %
            endif %
        }
    </script>
</body>

</html>
